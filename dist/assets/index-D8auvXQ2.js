import{d as O,p as d,s as W,q as X,v as Y,x as ee,c as h,a as A,b as l,A as te,e as s,w as o,B as C,R as le,E as r,F as U,r as E,f as b,n as m,C as L,S as ae,T as oe,Z as ne,o as v,U as re,_ as se}from"./index-26bRK5e0.js";import{n as ie,a as de,e as ue,b as pe,c as ce,d as me}from"./index-Dykcio9k.js";import"./request-DEdR8Geo.js";import"./utils-D3L-YqOM.js";const ve={class:"note-manager","element-loading-background":"rgba(255, 255, 255, 1)","element-loading-text":"正在全力加载中..."},fe={class:"function"},ge={class:"right-controls"},ye=O({__name:"index",setup(_e){const k=d([]),x=d([]),u=d(!1),S=d(0),n=d({page:1,pageSize:10,content:"",typeId:-1}),f=d(!1),g=d(!1),i=d({content:"",typeId:void 0}),_=d(),w=d(!1),R=W(()=>g.value?"编辑随笔":"新增随笔"),D={content:[{required:!0,message:"内容不能为空",trigger:"blur"},{min:1,max:500,message:"内容长度需要在 1-500 之间",trigger:"blur"}],typeId:[{required:!0,message:"类型不能为空",trigger:"change"}]},p=async()=>{u.value=!0;try{const a=await ie(n.value);a.code===1?k.value=a.data.rows:r.error(a.message||"获取随笔列表失败")}catch(a){r.error("获取随笔列表失败"),console.error(a)}finally{u.value=!1}},F=async()=>{try{const a=await de();a.code===1?x.value=a.data||[]:r.error(a.message||"获取随笔类型失败")}catch(a){r.error("获取随笔类型失败"),console.error(a)}},M=()=>{n.value.content="",n.value.typeId=-1,n.value.page=1,p()},q=async a=>{g.value=!0,w.value=!0;try{const e=await ce(a.id);if(e.code===1&&e.data)i.value={id:e.data.id,content:e.data.content,typeId:e.data.typeId};else{r.error("获取随笔详情失败");return}}catch(e){r.error("获取随笔详情失败"),console.error(e);return}finally{w.value=!1}f.value=!0,_.value?.clearValidate()},j=()=>{g.value=!1,i.value={content:"",typeId:void 0},f.value=!0,_.value?.clearValidate()},K=a=>{re.confirm("确定删除该随笔吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{u.value=!0;try{const e=await me(a.id);e.code===1?(r.success("删除成功"),await p()):r.error(e.message||"删除失败")}catch(e){r.error("删除失败"),console.error(e)}finally{u.value=!1}}).catch(()=>{r.info("已取消删除")})},I=async()=>{try{await _.value?.validate(),w.value=!0;const a=g.value?await ue(i.value):await pe(i.value);a.code===1?(r.success(g.value?"编辑成功":"新增成功"),f.value=!1,await p()):r.error(a.message||(g.value?"编辑失败":"新增失败"))}catch(a){console.error(a)}finally{w.value=!1}},N=()=>{f.value=!1,i.value={content:"",typeId:void 0},_.value?.clearValidate()};return X(async()=>{u.value=!0,await p(),await F(),u.value=!1}),(a,e)=>{const z=s("el-input"),V=s("el-option"),T=s("el-select"),c=s("el-button"),y=s("el-table-column"),P=s("el-table"),$=s("el-pagination"),Q=s("el-card"),B=s("el-form-item"),Z=s("el-form"),G=s("el-dialog"),H=ee("loading");return Y((v(),h("div",ve,[A("div",fe,[A("div",ge,[l(z,{modelValue:n.value.content,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.content=t),style:{width:"240px"},placeholder:"搜索内容",clearable:"",onKeydown:te(p,["enter"])},null,8,["modelValue"]),l(T,{modelValue:n.value.typeId,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.typeId=t),placeholder:"请选择类型",style:{width:"150px"}},{default:o(()=>[l(V,{label:"全部",value:-1}),(v(!0),h(U,null,E(x.value,t=>(v(),b(V,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(c,{style:{"margin-left":"0"},plain:"",type:"primary",onClick:p},{default:o(()=>[...e[7]||(e[7]=[m(" 搜索 ",-1)])]),_:1}),l(c,{style:{"margin-left":"0"},plain:"",onClick:M},{default:o(()=>[...e[8]||(e[8]=[m("重置",-1)])]),_:1}),l(c,{style:{"margin-left":"0"},plain:"",type:"success",icon:C(le),onClick:j},{default:o(()=>[...e[9]||(e[9]=[m(" 新增随笔 ",-1)])]),_:1},8,["icon"])])]),l(Q,{style:{"margin-top":"16px"}},{default:o(()=>[l(P,{data:k.value,loading:u.value,stripe:"",style:{width:"100%"}},{default:o(()=>[l(y,{type:"index",label:"序号",width:"60"}),l(y,{prop:"typeName",label:"类型",width:"100"}),l(y,{prop:"content",label:"内容","min-width":"300","show-overflow-tooltip":""}),l(y,{prop:"createTime",label:"创建时间",width:"180",align:"center","show-overflow-tooltip":""}),l(y,{prop:"updateTime",label:"修改时间",width:"180",align:"center","show-overflow-tooltip":""}),l(y,{label:"操作",width:"200",align:"center",fixed:"right"},{default:o(t=>[t.row.id?(v(),b(c,{key:0,plain:"",type:"primary",size:"small",icon:C(ae),onClick:J=>q(t.row)},{default:o(()=>[...e[10]||(e[10]=[m(" 编辑 ",-1)])]),_:1},8,["icon","onClick"])):L("",!0),t.row.id?(v(),b(c,{key:1,plain:"",type:"danger",size:"small",icon:C(oe),onClick:J=>K(t.row)},{default:o(()=>[...e[11]||(e[11]=[m(" 删除 ",-1)])]),_:1},8,["icon","onClick"])):L("",!0)]),_:1})]),_:1},8,["data","loading"]),l($,{"current-page":n.value.page,"onUpdate:currentPage":e[2]||(e[2]=t=>n.value.page=t),"page-size":n.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=t=>n.value.pageSize=t),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:p,onCurrentChange:p,style:{"margin-top":"20px","justify-content":"flex-end",display:"flex"}},null,8,["current-page","page-size","total"])]),_:1}),l(G,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t),title:R.value,width:"500px",onClose:N},{footer:o(()=>[l(c,{onClick:N},{default:o(()=>[...e[12]||(e[12]=[m("取消",-1)])]),_:1}),l(c,{type:"primary",loading:w.value,onClick:I},{default:o(()=>[...e[13]||(e[13]=[m(" 确认 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(Z,{ref_key:"formRef",ref:_,model:i.value,rules:D,"label-width":"80px",onSubmit:ne(I,["prevent"])},{default:o(()=>[l(B,{label:"类型",prop:"typeId"},{default:o(()=>[l(T,{modelValue:i.value.typeId,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value.typeId=t),placeholder:"请选择类型",style:{width:"100%"}},{default:o(()=>[(v(!0),h(U,null,E(x.value,t=>(v(),b(V,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(B,{label:"内容",prop:"content"},{default:o(()=>[l(z,{modelValue:i.value.content,"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.content=t),type:"textarea",placeholder:"请输入内容",rows:4,maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])),[[H,u.value]])}}}),he=se(ye,[["__scopeId","data-v-a309d2a6"]]);export{he as default};
