import{d as Q,p as d,s as W,q as X,v as Y,x as ee,c as C,a as P,b as t,w as o,e as i,B as k,R as le,E as r,F as E,r as U,f as x,n as m,t as ae,C as A,S as te,T as oe,Z as re,o as f,U as se,_ as ne}from"./index-JbcahPOn.js";import{a as D,b as ie,u as de,c as ue,d as ce,e as fe,f as pe}from"./index-C8kGlvVY.js";import{U as ve}from"./Upload-DtAyJ375.js";import"./request-BUaVHz46.js";import"./utils-CDasQK9Z.js";const me={class:"note-manager","element-loading-background":"rgba(255, 255, 255, 1)","element-loading-text":"正在全力加载中..."},ye={class:"function"},_e={class:"right-controls"},ge=Q({__name:"index",setup(he){const p=d([]),u=d([]),s=d(!1),V=d({typeId:-1}),v=d(!1),y=d(!1),n=d({url:"",typeId:void 0}),_=d(),g=d(!1),N=W(()=>y.value?"编辑英雄图":"新增英雄图"),F={url:[{required:!0,message:"图片地址不能为空",trigger:"blur"}],typeId:[{required:!0,message:"类型不能为空",trigger:"change"}]},M=l=>{const e=u.value.find(h=>h.id===l);return e?e.name:"-"},R=async()=>{s.value=!0;try{const l=V.value.typeId;let e;l===-1?e=await D():e=await pe(l),e.code===1?p.value=e.data||[]:r.error(e.message||"获取图片列表失败")}catch(l){r.error("获取图片列表失败"),console.error(l)}finally{s.value=!1}},b=async()=>{s.value=!0;try{const l=await D();l&&Array.isArray(l)?p.value=l:l?.code!==void 0&&l.code===1?p.value=l.data||[]:l?.data?p.value=l.data||[]:p.value=[]}catch(l){r.error("获取图片列表失败"),console.error(l)}finally{s.value=!1}},q=async()=>{try{const l=await ie();l&&Array.isArray(l)?u.value=l:l?.code!==void 0&&l.code===1?u.value=l.data||[]:l?.data?u.value=l.data||[]:u.value=[]}catch(l){r.error("获取图片类型失败"),console.error(l)}},S=async l=>{y.value=!0,g.value=!0;try{const e=await ce(l.id);e.code===1&&(n.value=e.data)}catch(e){r.error("获取图片详情失败"),console.error(e);return}finally{g.value=!1}v.value=!0,_.value?.clearValidate()},z=()=>{y.value=!1,n.value={url:"",typeId:void 0},v.value=!0,_.value?.clearValidate()},$=l=>{se.confirm("确定删除该图片吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{s.value=!0;try{const e=await fe(l.id);e?.code===void 0?(r.success("删除成功"),await b()):e.code===1?(r.success("删除成功"),await b()):r.error(e.message||"删除失败")}catch(e){r.error("删除失败"),console.error(e)}finally{s.value=!1}}).catch(()=>{r.info("已取消删除")})},I=()=>{g.value=!0,_.value?.validate(async l=>{if(l)try{let e;y.value?e=await de(n.value):e=await ue(n.value),e.code===1?(y.value?r.success("更新成功"):r.success("新增成功"),b(),g.value=!1,v.value=!1):r.error(e.message||"操作失败")}catch{r.error("操作失败")}finally{}})},T=()=>{v.value=!1,n.value={url:"",typeId:void 0},_.value?.clearValidate()};return X(async()=>{s.value=!0,await b(),await q(),s.value=!1}),(l,e)=>{const h=i("el-option"),B=i("el-select"),w=i("el-button"),c=i("el-table-column"),Z=i("el-image"),j=i("el-table"),G=i("el-card"),L=i("el-form-item"),H=i("el-form"),J=i("el-dialog"),K=ee("loading");return Y((f(),C("div",me,[P("div",ye,[P("div",_e,[t(B,{modelValue:V.value.typeId,"onUpdate:modelValue":e[0]||(e[0]=a=>V.value.typeId=a),placeholder:"请选择类型",style:{width:"150px"},onChange:R},{default:o(()=>[t(h,{label:"全部",value:-1}),(f(!0),C(E,null,U(u.value,a=>(f(),x(h,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(w,{style:{"margin-left":"0"},plain:"",type:"success",icon:k(le),onClick:z},{default:o(()=>[...e[4]||(e[4]=[m(" 新增图片 ",-1)])]),_:1},8,["icon"])])]),t(G,{style:{"margin-top":"16px"}},{default:o(()=>[t(j,{data:p.value,loading:s.value,stripe:"",style:{width:"100%"}},{default:o(()=>[t(c,{type:"index",label:"序号",width:"60"}),t(c,{label:"图片预览",width:"140"},{default:o(({row:a})=>[t(Z,{src:a.url,style:{width:"120px",height:"60px"},fit:"cover"},null,8,["src"])]),_:1}),t(c,{label:"类型",width:"120"},{default:o(({row:a})=>[m(ae(M(a.typeId)),1)]),_:1}),t(c,{prop:"url",label:"地址","min-width":"280","show-overflow-tooltip":""}),t(c,{prop:"createTime",label:"创建时间",width:"180",align:"center","show-overflow-tooltip":""}),t(c,{prop:"updateTime",label:"修改时间",width:"180",align:"center","show-overflow-tooltip":""}),t(c,{label:"操作",width:"200",align:"center",fixed:"right"},{default:o(a=>[a.row.id?(f(),x(w,{key:0,plain:"",type:"primary",size:"small",icon:k(te),onClick:O=>S(a.row)},{default:o(()=>[...e[5]||(e[5]=[m(" 编辑 ",-1)])]),_:1},8,["icon","onClick"])):A("",!0),a.row.id?(f(),x(w,{key:1,plain:"",type:"danger",size:"small",icon:k(oe),onClick:O=>$(a.row)},{default:o(()=>[...e[6]||(e[6]=[m(" 删除 ",-1)])]),_:1},8,["icon","onClick"])):A("",!0)]),_:1})]),_:1},8,["data","loading"])]),_:1}),t(J,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=a=>v.value=a),title:N.value,width:"500px",onClose:T},{footer:o(()=>[t(w,{onClick:T},{default:o(()=>[...e[7]||(e[7]=[m("取消",-1)])]),_:1}),t(w,{type:"primary",loading:g.value,onClick:I},{default:o(()=>[...e[8]||(e[8]=[m(" 确认 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(H,{ref_key:"formRef",ref:_,model:n.value,rules:F,"label-width":"80px",onSubmit:re(I,["prevent"])},{default:o(()=>[t(L,{label:"类型",prop:"typeId"},{default:o(()=>[t(B,{modelValue:n.value.typeId,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.typeId=a),placeholder:"请选择类型",style:{width:"100%"}},{default:o(()=>[(f(!0),C(E,null,U(u.value,a=>(f(),x(h,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(L,{label:"图片地址",prop:"url"},{default:o(()=>[t(ve,{modelValue:n.value.url,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.url=a),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])),[[K,s.value]])}}}),ke=ne(ge,[["__scopeId","data-v-49c5f6cb"]]);export{ke as default};
