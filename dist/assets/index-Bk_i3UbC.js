import{d as H,p as f,H as J,s as Z,q as G,v as K,x as P,c as Q,a as C,b as t,w as a,B as b,R as W,e as d,E as n,n as u,t as X,f as g,C as A,S as Y,J as ee,I as te,T as le,Z as ae,o as m,U as F,_ as oe}from"./index-26bRK5e0.js";import{a as re,u as U,i as ne,b as ie,d as se}from"./index-Cp3lKWJ8.js";import"./request-DEdR8Geo.js";import"./utils-D3L-YqOM.js";const de={class:"friendlink-manager","element-loading-background":"rgba(255, 255, 255, 1)","element-loading-text":"正在全力加载中..."},ue={class:"function"},ce={class:"right-controls"},me=["href"],pe=H({__name:"index",setup(fe){const E=f([]),s=f(!1),p=f(!1),V=f(!1),r=J({name:"",url:"",img:"",description:"",authorEmail:"",status:0}),v=f(),_=f(!1),q=Z(()=>V.value?"编辑友链":"新增友链"),D={name:[{required:!0,message:"请填写网站名称",trigger:"blur"}],authorEmail:[{required:!0,type:"email",message:"请填写有效邮箱",trigger:"blur"}],url:[{required:!0,message:"请输入网站地址",trigger:"blur"}],description:[{required:!0,message:"请输入网站描述",trigger:"blur"}],img:[{required:!0,message:"请上传网站图标",trigger:"blur"}]},k=async()=>{s.value=!0;try{const o=await re();o.code===1?E.value=o.data||[]:n.error(o.message||"获取友链列表失败")}catch(o){n.error("获取友链列表失败"),console.error(o)}finally{s.value=!1}},S=()=>{V.value=!1,Object.assign(r,{id:void 0,name:"",url:"",img:"",description:"",authorEmail:"",status:0}),p.value=!0,v.value?.clearValidate?.()},z=async o=>{V.value=!0,_.value=!0;try{const e=await ie(o.id);if(e.code===1&&e.data)Object.assign(r,e.data);else{n.error("获取友链详情失败");return}}catch(e){n.error("获取友链详情失败"),console.error(e);return}finally{_.value=!1}p.value=!0,v.value?.clearValidate?.()},M=o=>{F.confirm("确定删除该友链吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{s.value=!0;try{const e=await se(o.id);e.code===1?(n.success("删除成功"),await k()):n.error(e.message||"删除失败")}catch(e){n.error("删除失败"),console.error(e)}finally{s.value=!1}}).catch(()=>{n.info("已取消删除")})},N=async()=>{try{await v.value?.validate?.(),_.value=!0;const o={...r},e=o.id?await U(o):await ne(o);e.code===1?(n.success(o.id?"编辑成功":"新增成功"),p.value=!1,await k()):n.error(e.message||(o.id?"编辑失败":"新增失败"))}catch(o){console.error(o)}finally{_.value=!1}},B=()=>{p.value=!1,Object.assign(r,{name:"",url:"",img:"",description:"",authorEmail:"",status:0}),v.value?.clearValidate?.()},T=o=>{const e=o.status===0?1:0,c=e===1?"确认审核通过该友链吗？":"确认停用该友链吗？";F.confirm(c,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{s.value=!0;try{const i={...o,status:e},h=await U(i);h.code===1?(n.success(e===1?"审核通过":"已停用"),await k()):n.error(h.message||(e===1?"审核失败":"停用失败"))}catch(i){n.error(e===1?"审核失败":"停用失败"),console.error(i)}finally{s.value=!1}}).catch(()=>{n.info("已取消")})};return G(async()=>{s.value=!0,await k(),s.value=!1}),(o,e)=>{const c=d("el-button"),i=d("el-table-column"),h=d("el-text"),L=d("el-tag"),$=d("el-table"),j=d("el-card"),w=d("el-input"),y=d("el-form-item"),I=d("el-form"),O=d("el-dialog"),R=P("loading");return K((m(),Q("div",de,[C("div",ue,[C("div",ce,[t(c,{plain:"",type:"success",icon:b(W),onClick:S},{default:a(()=>[...e[7]||(e[7]=[u("新增友链",-1)])]),_:1},8,["icon"])])]),t(j,{style:{"margin-top":"16px"}},{default:a(()=>[t($,{data:E.value,loading:s.value,stripe:"",style:{width:"100%"}},{default:a(()=>[t(i,{type:"index",label:"序号",width:"60"}),t(i,{prop:"name",label:"名称","min-width":"150","show-overflow-tooltip":""},{default:a(l=>[C("a",{href:l.row.url,target:"_blank",style:{"text-decoration":"none"}},[t(h,null,{default:a(()=>[u(X(l.row.name),1)]),_:2},1024)],8,me)]),_:1}),t(i,{prop:"url",label:"网址","min-width":"200","show-overflow-tooltip":""}),t(i,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(i,{prop:"authorEmail",label:"联系邮箱",width:"180","show-overflow-tooltip":""}),t(i,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(l=>[l.row.status===0?(m(),g(L,{key:0,type:"warning"},{default:a(()=>[...e[8]||(e[8]=[u("待审核",-1)])]),_:1})):(m(),g(L,{key:1,type:"success"},{default:a(()=>[...e[9]||(e[9]=[u("已通过",-1)])]),_:1}))]),_:1}),t(i,{prop:"createTime",label:"创建时间",width:"180",align:"center"}),t(i,{label:"操作",width:"240",align:"center",fixed:"right"},{default:a(l=>[l.row.id?(m(),g(c,{key:0,plain:"",type:"primary",size:"small",icon:b(Y),onClick:x=>z(l.row)},{default:a(()=>[...e[10]||(e[10]=[u(" 编辑 ",-1)])]),_:1},8,["icon","onClick"])):A("",!0),l.row.status===0?(m(),g(c,{key:1,plain:"",type:"success",size:"small",icon:b(ee),onClick:x=>T(l.row)},{default:a(()=>[...e[11]||(e[11]=[u(" 审核 ",-1)])]),_:1},8,["icon","onClick"])):(m(),g(c,{key:2,plain:"",type:"warning",size:"small",icon:b(te),onClick:x=>T(l.row)},{default:a(()=>[...e[12]||(e[12]=[u(" 停用 ",-1)])]),_:1},8,["icon","onClick"])),l.row.id?(m(),g(c,{key:3,plain:"",type:"danger",size:"small",icon:b(le),onClick:x=>M(l.row)},{default:a(()=>[...e[13]||(e[13]=[u(" 删除 ",-1)])]),_:1},8,["icon","onClick"])):A("",!0)]),_:1})]),_:1},8,["data","loading"])]),_:1}),t(O,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=l=>p.value=l),title:q.value,width:"600px",onClose:B},{footer:a(()=>[t(c,{onClick:B},{default:a(()=>[...e[14]||(e[14]=[u("取消",-1)])]),_:1}),t(c,{type:"primary",loading:_.value,onClick:N},{default:a(()=>[...e[15]||(e[15]=[u(" 确认 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(I,{ref_key:"formRef",ref:v,model:r,rules:D,"label-width":"100px",onSubmit:e[5]||(e[5]=ae(()=>{},["prevent"]))},{default:a(()=>[t(y,{label:"网站名称",prop:"name"},{default:a(()=>[t(w,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=l=>r.name=l),maxlength:"60",placeholder:"请输入网站名称"},null,8,["modelValue"])]),_:1}),t(y,{label:"联系邮箱",prop:"authorEmail"},{default:a(()=>[t(w,{modelValue:r.authorEmail,"onUpdate:modelValue":e[1]||(e[1]=l=>r.authorEmail=l),placeholder:"请输入联系邮箱"},null,8,["modelValue"])]),_:1}),t(y,{label:"网站网址",prop:"url"},{default:a(()=>[t(w,{modelValue:r.url,"onUpdate:modelValue":e[2]||(e[2]=l=>r.url=l),placeholder:"请输入网站地址"},null,8,["modelValue"])]),_:1}),t(y,{label:"网站图标",prop:"img"},{default:a(()=>[t(w,{modelValue:r.img,"onUpdate:modelValue":e[3]||(e[3]=l=>r.img=l),placeholder:"请输入网站图标地址"},null,8,["modelValue"])]),_:1}),t(y,{label:"网站描述",prop:"description"},{default:a(()=>[t(w,{modelValue:r.description,"onUpdate:modelValue":e[4]||(e[4]=l=>r.description=l),type:"textarea",rows:3,placeholder:"请输入网站描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])),[[R,s.value]])}}}),ye=oe(pe,[["__scopeId","data-v-e8da0478"]]);export{ye as default};
